!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_error",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const o=t.id+"-error";e.querySelector("#"+o).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?(t.disabled=!0,t.classList.add(r.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}processResponse(e){if(e.ok)return e.json();Promise.reject(`Error:${e.status}`)}getUserInfo(){return fetch("https://around-api.en.tripleten-services.com/v1/users/me",{headers:this._headers}).then(this.processResponse)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch("https://around-api.en.tripleten-services.com/v1/cards",{headers:this._headers}).then(this.processResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this.processResponse)}editAvatar({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this.processResponse)}addCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this.processResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this.processResponse)}handleLike(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this.processResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"5ce8c54d-16fe-4e42-b491-e5b9e13adf08","Content-Type":"application/json"}});o.getAppInfo().then(([e,t])=>{console.log(e,t),e.forEach(function(e){const t=w(e);A.prepend(t)}),l.textContent=t.name,u.textContent=t.about,d.src=t.avatar}).catch(console.error);const n=document.querySelector(".profile__edit-button"),s=document.querySelector("#edit-profile-modal"),a=s.querySelector(".modal__close-button"),c=s.querySelector("#profile-name-input"),i=s.querySelector("#profile-description-input"),l=document.querySelector(".profile__name"),d=document.querySelector(".profile__avatar"),u=document.querySelector(".profile__description"),m=s.querySelector(".modal__form"),_=document.querySelector(".profile__plus-button"),h=document.querySelector("#new-post-modal"),p=h.querySelector(".modal__close-button"),v=h.querySelector(".modal__form"),f=document.querySelector("#post-description-input"),y=document.querySelector("#card-image-input"),S=document.querySelector(".profile__avatar-button"),b=document.querySelector("#edit-avatar-modal"),q=b.querySelector(".modal__close-button"),L=b.querySelector(".modal__form"),E=document.querySelector("#avatar-image-input");S.addEventListener("click",function(){D(b)}),q.addEventListener("click",function(){P(b)});const k=document.querySelector("#preview-modal"),C=k.querySelector(".modal__close-button_preview"),g=k.querySelector(".modal__image"),U=k.querySelector(".modal__caption"),x=document.querySelector("#card-template").content.querySelector(".card"),A=document.querySelector(".cards__list"),I=document.querySelector("#delete-modal"),R=I.querySelector(".modal__close-button_delete");let $,T;function w(e){const t=x.cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image");n.src=e.link,n.alt=e.name,r.textContent=e.name;const s=t.querySelector(".card__like-button");return e.isLiked&&s.classList.add("card__like-button_active"),s.addEventListener("click",t=>o.handleLike(e._id,s.classList.contains("card__like-button_active")).then(()=>s.classList.toggle("card__like-button_active"))),t.querySelector(".card__delete-button").addEventListener("click",()=>{$=t,T=e._id,D(I)}),n.addEventListener("click",()=>{g.src=e.link,g.alt=e.name,U.textContent=e.name,D(k)}),t}function D(e){e.classList.add("modal_is-opened"),e.addEventListener("click",B),document.addEventListener("keydown",N)}function P(e){e.classList.remove("modal_is-opened"),e.removeEventListener("click",B),document.removeEventListener("keydown",N)}function B(e){e.target.classList.contains("modal")&&P(e.target)}function N(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&P(e)}}var O;document.querySelector(".modal__cancel-button").addEventListener("click",function(){P(I)}),R.addEventListener("click",function(){P(I)}),document.querySelector("#modal-delete-form").addEventListener("submit",function(e){e.preventDefault(),o.deleteCard(T).then(()=>{$.remove(),P(I)})}),n.addEventListener("click",function(){var r,o;c.value=l.textContent,i.value=u.textContent,r=m,o=e,[c,i].forEach(e=>{t(r,e,o)}),D(s)}),a.addEventListener("click",function(){P(s)}),_.addEventListener("click",function(){D(h)}),p.addEventListener("click",function(){P(h)}),C.addEventListener("click",function(){P(k)}),m.addEventListener("submit",function(e){e.preventDefault(),o.editUserInfo({name:c.value,about:i.value}).then(e=>{l.textContent=e.name,u.textContent=e.about,P(s)}).catch(console.error)}),L.addEventListener("submit",function(e){e.preventDefault(),o.editAvatar({avatar:E.value}).then(e=>{d.src=e.avatar,P(b)}).catch(console.error)}),v.addEventListener("submit",function(t){t.preventDefault();const n={name:f.value,link:y.value};o.addCard(n).then(o=>{const n=w(o);A.prepend(n),v.reset(),r([f,y],t.submitter,e),P(h)})}),O=e,document.querySelectorAll(O.formSelector).forEach(e=>{!function(e,o){const n=Array.from(e.querySelectorAll(o.inputSelector)),s=e.querySelector(o.submitButtonSelector);r(n,s,o),n.forEach(a=>{a.addEventListener("input",function(){((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{const n=t.id+"-error",s=document.querySelector("#"+n);console.log(e),s.textContent=r,t.classList.add(o.inputErrorClass),s.classList.add(o.errorClass)})(e,r,r.validationMessage,o)})(e,a,o),r(n,s,o)})})}(e,O)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VHVDLEVBQUMvSCxFQUFhQyxFQUFjQyxLQUN2REQsRUFBYWEsU0FBU0MsTUFRekJoQixFQUFlQyxFQUFhQyxFQUFjQyxHQTlCaEI4SCxFQUM1QmhJLEVBQ0FDLEVBQ0FnSSxFQUNBL0gsS0FFQSxNQUFNQyxFQUFpQkYsRUFBYUcsR0FBSyxTQUNuQzhILEVBQXNCM0QsU0FBU2xFLGNBQWMsSUFBTUYsR0FDekRxRCxRQUFRQyxJQUFJekQsR0FDWmtJLEVBQW9CNUgsWUFBYzJILEVBQ2xDaEksRUFBYU0sVUFBVVcsSUFBSWhCLEVBQU9MLGlCQUNsQ3FJLEVBQW9CM0gsVUFBVVcsSUFBSWhCLEVBQU9KLGFBWXZDa0ksQ0FDRWhJLEVBQ0FDLEVBQ0FBLEVBQWFrSSxrQkFDYmpJLElBc0NBNkgsQ0FBbUIvSCxFQUFhQyxFQUFjQyxHQUM5Q08sRUFBa0JDLEVBQVdDLEVBQWVULEVBQzlDLElBRUosQ0FLSWtJLENBQWtCcEksRUFBYUUsSSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ1dHRvbl9lcnJvclwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuZXhwb3J0IGNvbnN0IHNob3dJbnB1dEVycm9yID0gKFxuICBmb3JtRWxlbWVudCxcbiAgaW5wdXRFbGVtZW50LFxuICBlcnJvck1lc3NhZ2UsXG4gIGNvbmZpZ1xuKSA9PiB7XG4gIGNvbnN0IGVycm9yTWVzc2FnZUlEID0gaW5wdXRFbGVtZW50LmlkICsgXCItZXJyb3JcIjtcbiAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjXCIgKyBlcnJvck1lc3NhZ2VJRCk7XG4gIGNvbnNvbGUubG9nKGZvcm1FbGVtZW50KTtcbiAgZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG4gIGVycm9yTWVzc2FnZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuZXJyb3JDbGFzcyk7XG59O1xuXG5leHBvcnQgY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTWVzc2FnZUlEID0gaW5wdXRFbGVtZW50LmlkICsgXCItZXJyb3JcIjtcbiAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjXCIgKyBlcnJvck1lc3NhZ2VJRCk7XG4gIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoXG4gICAgICBmb3JtRWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgIGNvbmZpZ1xuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZykge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpXG4gICk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZyk7XG4gIH0pO1xufTtcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICBzZXR0aW5ncyxcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICB0b2dnbGVCdXR0b25TdGF0ZSxcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuXG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNWNlOGM1NGQtMTZmZS00ZTQyLWI0OTEtZTViOWUxM2FkZjA4XCIsIC8vIFJlcGxhY2Ugd2l0aCB5b3VyIGFjdHVhbCB0b2tlblxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHVzZXJJbmZvXSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGNhcmRzLCB1c2VySW5mbyk7XG4gICAgY2FyZHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgICB9KTtcbiAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gdXNlckluZm8ubmFtZTtcbiAgICBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xuICAgIHByb2ZpbGVBdmF0YXJFbC5zcmMgPSB1c2VySW5mby5hdmF0YXI7XG4gIH0pXG5cbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG4vL1ZhcmlhYmxlc1xuXG4vL0VkaXQgUHJvZmlsZSBWYXJpYWJsZXNcbmNvbnN0IGVkaXRQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdXR0b24gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idXR0b25cIixcbik7XG5jb25zdCBlZGl0UHJvZmlsZU5hbWVJbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1uYW1lLWlucHV0XCIsXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCIsXG4pO1xuY29uc3QgcHJvZmlsZU5hbWVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVGb3JtRWwgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5cbi8vQWRkIE5ldyBQb3N0IFZhcmlhYmxlc1xuY29uc3QgbmV3UG9zdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fcGx1cy1idXR0b25cIik7XG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgbmV3UG9zdENsb3NlQnV0dG9uID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKTtcblxuY29uc3QgYWRkQ2FyZEZvcm1FbCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3N0LWRlc2NyaXB0aW9uLWlucHV0XCIpO1xuY29uc3QgbGlua0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLWltYWdlLWlucHV0XCIpO1xuXG4vL0VkaXQgQXZhdGFyIE1vZGFsIGFuZCBTdWJtaXQgQXZhdGFyIENoYW5nZSAoVmFyaWFibGVzIGFuZCBGdW5jdGlvbnMpXG5jb25zdCBlZGl0QXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnV0dG9uXCIpO1xuY29uc3QgZWRpdEF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGVkaXRBdmF0YXJDbG9zZUJ1dHRvbiA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIsXG4pO1xuY29uc3QgZWRpdEF2YXRhckZvcm0gPSBlZGl0QXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGF2YXRhckxpbmtJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWltYWdlLWlucHV0XCIpO1xuXG5lZGl0QXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Nb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xufSk7XG5cbmVkaXRBdmF0YXJDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGVkaXRBdmF0YXJNb2RhbCk7XG59KTtcblxuLy9WYXJpYWJsZXMgKFN0YWdlIDggUGFydCBJSSlcblxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2xvc2VCdXR0b24gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvbl9wcmV2aWV3XCIsXG4pO1xuY29uc3QgcHJldmlld0ltYWdlRWxlbWVudCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdDYXB0aW9uRWxlbWVudCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuLy9WYXJpYWJsZXMgKFN0YWdlIDgpXG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XG4gIC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIilcbiAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcblxuY29uc3QgZGVsZXRlTW9kYWxDbG9zZUJ1dHRvbiA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idXR0b25fZGVsZXRlXCIsXG4pO1xuXG5jb25zdCBkZWxldGVNb2RhbENhbmNlbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhbmNlbC1idXR0b25cIik7XG5cbmxldCBzZWxlY3RlZENhcmQsIHNlbGVjdGVkQ2FyZElkO1xuXG5kZWxldGVNb2RhbENhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbn0pO1xuXG5kZWxldGVNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5cbmNvbnN0IGRlbGV0ZU1vZGFsRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9kYWwtZGVsZXRlLWZvcm1cIik7XG5cbmRlbGV0ZU1vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBhcGkuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZCkudGhlbigoKSA9PiB7XG4gICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9KTtcbn0pO1xuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZFRpdGxlRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuXG4gIGNhcmRJbWFnZUVsZW1lbnQuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcbiAgY2FyZFRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgLy9DYXJkIGxpa2UgYnV0dG9uXG4gIGNvbnN0IGNhcmRMaWtlQnV0dG9uRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgfVxuXG4gIGNhcmRMaWtlQnV0dG9uRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PlxuICAgIGFwaVxuICAgICAgLmhhbmRsZUxpa2UoXG4gICAgICAgIGRhdGEuX2lkLFxuICAgICAgICBjYXJkTGlrZUJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpLFxuICAgICAgKVxuICAgICAgLnRoZW4oKCkgPT5cbiAgICAgICAgY2FyZExpa2VCdXR0b25FbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIiksXG4gICAgICApLFxuICApO1xuXG4gIGNvbnN0IGNhcmREZWxldGVCdXR0b25FbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIsXG4gICk7XG5cbiAgLy9EZWxldGUgZm9ybSBlbGVtZW50c1xuXG4gIGNhcmREZWxldGVCdXR0b25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgLy9jYXJkRGVsZXRlQnV0dG9uRWxlbWVudC5jbG9zZXN0KFwiLmNhcmRcIikucmVtb3ZlKCk7XG4gICAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gICAgc2VsZWN0ZWRDYXJkSWQgPSBkYXRhLl9pZDtcbiAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9KTtcblxuICBjYXJkSW1hZ2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgcHJldmlld0ltYWdlRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XG4gICAgcHJldmlld0ltYWdlRWxlbWVudC5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld0NhcHRpb25FbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlT3ZlcmxheUNsaWNrKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjYXBlKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlT3ZlcmxheUNsaWNrKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjYXBlKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlT3ZlcmxheUNsaWNrKGV2ZW50KSB7XG4gIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIGNsb3NlTW9kYWwoZXZlbnQudGFyZ2V0KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRXNjYXBlKGV2dCkge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG9wZW5Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfaXMtb3BlbmVkXCIpO1xuICAgIGlmIChvcGVuTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3Blbk1vZGFsKTtcbiAgICB9XG4gIH1cbn1cblxuZWRpdFByb2ZpbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50O1xuICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIGVkaXRQcm9maWxlRm9ybUVsLFxuICAgIFtlZGl0UHJvZmlsZU5hbWVJbnB1dCwgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0XSxcbiAgICBzZXR0aW5ncyxcbiAgKTtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQ2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbm5ld1Bvc3RDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG59KTtcblxucHJldmlld01vZGFsQ2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xufSk7XG5cbi8vIEVkaXQgUHJvZmlsZVxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlLFxuICAgICAgYWJvdXQ6IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgLy9maXggZGF0YSBzdWJtaXNzaW9uIC0gaW5zdGVhZCBvZiBpbnB1dCB2YWx1ZXNcbn1cblxuLy9hdmF0YXIgc3VibWl0IGZ1bmN0aW9uXG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBhcGlcbiAgICAuZWRpdEF2YXRhcih7XG4gICAgICBhdmF0YXI6IGF2YXRhckxpbmtJbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlQXZhdGFyRWwuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRBdmF0YXJNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG59XG5cbmVkaXRQcm9maWxlRm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xuZWRpdEF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KTtcblxuLy8gQWRkIE5ldyBQb3N0XG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBpbnB1dFZhbHVlcyA9IHtcbiAgICBuYW1lOiBuYW1lSW5wdXQudmFsdWUsXG4gICAgbGluazogbGlua0lucHV0LnZhbHVlLFxuICB9O1xuICBhcGkuYWRkQ2FyZChpbnB1dFZhbHVlcykudGhlbigoZGF0YSkgPT4ge1xuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoZGF0YSk7XG4gICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIGFkZENhcmRGb3JtRWwucmVzZXQoKTtcbiAgICB0b2dnbGVCdXR0b25TdGF0ZShbbmFtZUlucHV0LCBsaW5rSW5wdXRdLCBldnQuc3VibWl0dGVyLCBzZXR0aW5ncyk7XG4gICAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xuICB9KTtcbn1cblxuYWRkQ2FyZEZvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRTdWJtaXQpO1xuXG4vL0xvZ1xuXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBwcm9jZXNzUmVzcG9uc2UocmVzKSB7XG4gICAgaWYgKHJlcy5vaykge1xuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgfVxuICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjoke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MS91c2Vycy9tZVwiLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5wcm9jZXNzUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxL2NhcmRzXCIsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLnByb2Nlc3NSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5wcm9jZXNzUmVzcG9uc2UpO1xuICB9XG5cbiAgZWRpdEF2YXRhcih7IGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXZhdGFyLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLnByb2Nlc3NSZXNwb25zZSk7XG4gIH1cblxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMucHJvY2Vzc1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5wcm9jZXNzUmVzcG9uc2UpO1xuICB9XG5cbiAgaGFuZGxlTGlrZShpZCwgaXNMaWtlZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMucHJvY2Vzc1Jlc3BvbnNlKTtcbiAgfVxuICAvLyBvdGhlciBtZXRob2RzIGZvciB3b3JraW5nIHdpdGggdGhlIEFQSVxufVxuXG5leHBvcnQgZGVmYXVsdCBBcGk7XG4iXSwibmFtZXMiOlsic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJjb25maWciLCJlcnJvck1lc3NhZ2VJRCIsImlkIiwicXVlcnlTZWxlY3RvciIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50Iiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVkIiwiYWRkIiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwicHJvY2Vzc1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0QXBwSW5mbyIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdEF2YXRhciIsImF2YXRhciIsImFkZENhcmQiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImhhbmRsZUxpa2UiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzIiwidXNlckluZm8iLCJjb25zb2xlIiwibG9nIiwiZm9yRWFjaCIsIml0ZW0iLCJjYXJkRWxlbWVudCIsImdldENhcmRFbGVtZW50IiwiY2FyZHNMaXN0IiwicHJlcGVuZCIsInByb2ZpbGVOYW1lRWwiLCJwcm9maWxlRGVzY3JpcHRpb25FbCIsInByb2ZpbGVBdmF0YXJFbCIsInNyYyIsImNhdGNoIiwiZXJyb3IiLCJlZGl0UHJvZmlsZUJ1dHRvbiIsImRvY3VtZW50IiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlQ2xvc2VCdXR0b24iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImVkaXRQcm9maWxlRm9ybUVsIiwibmV3UG9zdEJ1dHRvbiIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RDbG9zZUJ1dHRvbiIsImFkZENhcmRGb3JtRWwiLCJuYW1lSW5wdXQiLCJsaW5rSW5wdXQiLCJlZGl0QXZhdGFyQnV0dG9uIiwiZWRpdEF2YXRhck1vZGFsIiwiZWRpdEF2YXRhckNsb3NlQnV0dG9uIiwiZWRpdEF2YXRhckZvcm0iLCJhdmF0YXJMaW5rSW5wdXQiLCJhZGRFdmVudExpc3RlbmVyIiwib3Blbk1vZGFsIiwiY2xvc2VNb2RhbCIsInByZXZpZXdNb2RhbCIsInByZXZpZXdNb2RhbENsb3NlQnV0dG9uIiwicHJldmlld0ltYWdlRWxlbWVudCIsInByZXZpZXdDYXB0aW9uRWxlbWVudCIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJkZWxldGVNb2RhbCIsImRlbGV0ZU1vZGFsQ2xvc2VCdXR0b24iLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImRhdGEiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGVFbGVtZW50IiwiY2FyZEltYWdlRWxlbWVudCIsImFsdCIsImNhcmRMaWtlQnV0dG9uRWxlbWVudCIsImV2ZW50IiwiX2lkIiwiY29udGFpbnMiLCJ0b2dnbGUiLCJtb2RhbCIsImhhbmRsZU92ZXJsYXlDbGljayIsImhhbmRsZUVzY2FwZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJ0YXJnZXQiLCJldnQiLCJrZXkiLCJwcmV2ZW50RGVmYXVsdCIsInJlc2V0VmFsaWRhdGlvbiIsInZhbHVlIiwiaW5wdXRWYWx1ZXMiLCJyZXNldCIsInN1Ym1pdHRlciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJBcnJheSIsImZyb20iLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsImVycm9yTWVzc2FnZUVsZW1lbnQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInNldEV2ZW50TGlzdGVuZXJzIl0sInNvdXJjZVJvb3QiOiIifQ==